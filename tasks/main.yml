---
# tasks file for ripple-solution

- name: "Require Correct Linux Distribution"
  assert:
    that: ansible_distribution | lower in ['redhat', 'centos']
    msg:  "This Linux distrution is not supported by the role."
  tags: ripple-solution

- name: "Require Supported RDBMS"
  assert:
    that: ripple_solution_db_dialect in ['postgres']
    msg:  "This role supports only 'postgres' RDBMS for Ripple Solution."
  tags: ripple-solution

- name: "Build Data Structures"
  include: datastructs.yml
  tags: ripple-solution

- name: "Install Ripple Solution"
  include: install.yml
  tags: ripple-solution

- name: "Pre-Configuration RDBMS"
  delegate_to: localhost
  include: "{{ ripple_solution_db_dialect }}_pre.yml"
  tags: ripple-solution

- name: "Install Databases"
  include: databases.yml
  tags: ripple-solution

- name: "Post-Configuration RDBMS"
  delegate_to: localhost
  include: "{{ ripple_solution_db_dialect }}_post.yml"
  tags: ripple-solution

- name: "Create Certificates"
  include: certificates.yml
  tags: ripple-solution

- name: "Ripple Configuration"
  become_user: "{{ ripple_solution_user }}"
  include: config.yml
  tags: ripple-solution

- name: "Initialization"
  include: init.yml
  tags: ripple-solution

- name: "Ledger Accounts"
  include: accounts.yml
  with_items:
   - "{{ ilp_ledgers_info | default([]) }}"
  loop_control:
    loop_var: ledger
  tags: ripple-solution
