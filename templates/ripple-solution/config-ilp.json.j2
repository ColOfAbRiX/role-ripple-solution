{
{% if ripple_connect_enabled | bool %}
  "ripple-connect": {
    "RC_CONFIGS_PATH": "{{ ripple_solution_config_base }}",
    "RC_SECRETS_ENCRYPTED": {{ ripple_connect_secrets_encrypted }},
    "RC_ENABLE_UI": {{ ripple_connect_enable_ui }}
  }{% if ilp_ledgers | default([]) or ilp_validator_enabled | default(False) | bool or fx_connector_enabled | default(False) | bool %},{% endif %}


{% endif %}
{% for ledger in ilp_ledgers %}
  "ledger{{ loop.index0 }}": {
    "LEDGER_HOSTNAME": "{{ ledger.host }}",
    "LEDGER_PORT": {{ ledger.port }},
    "LEDGER_DB_URI": "{{ ripple_solution_db_dialect }}://{{ ledger.db_user }}:{{ ledger.db_pass }}@{{ ledger.db_host }}:{{ ledger.db_port }}/{{ ledger.db_name }}",
    "LEDGER_TLS_KEY": "{{ key_path }}/{{ ledger_crt_prefix }}-key.pem",
    "LEDGER_TLS_CERTIFICATE": "{{ cert_path }}/{{ ledger_crt_prefix }}-crt.pem",
    "LEDGER_ADMIN_FINGERPRINT": "{{ fingerprints.results[admin_crt_idx].stdout }}",
    "LEDGER_AMOUNT_SCALE": {{ ripple_connect_config.amount_decimal_scale }},
{% for key, value in (ledger.config | default({})).iteritems() %}
    "LEDGER_{{ key | upper }}": "{{ value }}",
{% endfor %}
    "LEDGER_TLS_CAS": [
{% for cert in ledger.trusted_external_certs | default([]) %}
      "{{ cert_ext_path }}/{{ cert }}",
{% endfor %}
      "{{ ca_cert }}"
    ]
  }{% if not loop.last or ilp_validator_enabled | default(False) | bool or fx_connector_enabled | default(False) | bool %},{% endif %}


{% endfor %}
{% if ilp_validator_enabled | default(False) | bool %}
  "validator": {
    "VALIDATOR_HOSTNAME": "{{ ilp_validator_host }}",
    "VALIDATOR_PORT": {{ ilp_validator_port }},
    "VALIDATOR_DB_URI": "{{ ripple_solution_db_dialect }}://{{ ilp_validator_db_user }}:{{ ilp_validator_db_pass }}@{{ ilp_validator_db_host }}:{{ ilp_validator_db_port }}/{{ ilp_validator_db_name }}",
{% for key, value in (ilp_validator_config | default({})).iteritems() %}
    "VALIDATOR_{{ key | upper }}": "{{ value }}",
{% endfor %}
    "VALIDATOR_ED25519_PUBLIC_KEY": "{{ validator_key.stdout_lines[0].split(' ')[2] }}",
    "VALIDATOR_ED25519_SECRET_KEY": "{{ validator_key.stdout_lines[1].split(' ')[2] }}",
    "VALIDATOR_TLS_KEY": "{{ key_path }}/{{ validator_crt_prefix }}-key.pem",
    "VALIDATOR_TLS_CERTIFICATE": "{{ cert_path }}/{{ validator_crt_prefix }}-crt.pem",
    "VALIDATOR_TLS_CAS": [
{% for cert in ilp_validator_trusted_external_certs | default([]) %}
      "{{ cert_ext_path }}/{{ cert }}",
{% endfor %}
      "{{ ca_cert }}"
    ]
  }{% if fx_connector_enabled | default(False) | bool %},{% endif %}


{% endif %}
{% if fx_connector_enabled | default(False) | bool %}
  "connector": {
    "CONNECTOR_PORT": {{ fx_connector_port }},
    "CONNECTOR_DB_URI": "{{ ripple_solution_db_dialect }}://{{ fx_connector_db_user }}:{{ fx_connector_db_pass }}@{{ fx_connector_db_host }}:{{ fx_connector_db_port }}/{{ fx_connector_db_name }}",
    "CONNECTOR_TLS_KEY": "{{ key_path }}/{{ fx_connector_crt_prefix }}-key.pem",
    "CONNECTOR_TLS_CERTIFICATE": "{{ cert_path }}/{{ fx_connector_crt_prefix }}-crt.pem",
    "CONNECTOR_ADMIN_FINGERPRINT": "{{ fingerprints.results[admin_crt_idx].stdout }}",
{% for key, value in (fx_connector_config | default({})).iteritems() %}
    "CONNECTOR_{{ key | upper }}": "{{ value }}",
{% endfor %}
{% for secret_result in connector_secrets.results %}
    "{{ secret_result.item }}": "{{ secret_result.stdout.split(' ')[2] }}",
{% endfor %}
    "CONNECTOR_TLS_CAS": [
{% for cert in fx_connector_trusted_external_certs | default([]) %}
      "{{ cert_ext_path }}/{{ cert }}",
{% endfor %}
      "{{ ca_cert }}"
    ],
    "CONNECTOR_LEDGER_CREDENTIALS": {
{% for ledger in ilp_ledgers | default([]) %}
      "{% if ledger.config.auth_client_cert_enabled | default(False) | bool %}https{% else %}http{% endif %}://{{ ledger.host }}:{{ ledger.port }}/account/{{ fx_connector_ledger_user }}": {
        "authorized_access_fingerprints": [
          "{{ fingerprints.results[ripple_connect_crt_idx].stdout }}"
        ],
        "cert": "{{ cert_path }}/{{ fx_connector_crt_prefix }}-crt.pem",
        "key": "{{ key_path }}/{{ fx_connector_crt_prefix }}-key.pem",
        "ca": [
          "{{ ca_cert }}"
        ]
      }{% if fx_connector_ledgers | default([]) | length > 0 %},{% endif %}

{% endfor %}
{% for ledger in fx_connector_ledgers | default([]) %}
      "{{ ledger.url }}/account/{{ fx_connector_ledger_user }}": {
        "authorized_access_fingerprints": [
{% for f in ledger.fingerprints | default([]) %}
          "{{ f }}"{% if not loop.last %},{% endif %}

{% endfor %}
        ],
        "cert": "{{ cert_path }}/{{ fx_connector_crt_prefix }}-crt.pem",
        "key": "{{ key_path }}/{{ fx_connector_crt_prefix }}-key.pem",
        "ca": [
          "{{ cert_ext_path }}/{{ ledger.cert }}",
          "{{ ca_cert }}"
        ]
      }{% if not loop.last %},{% endif %}

{% endfor %}
    },
    "CONNECTOR_PAIRS": [
{% for pair in fx_connector_pairs | default([]) %}
      [
        "{{ pair[0] }}",
        "{{ pair[1] }}"
      ], [
        "{{ pair[1] }}",
        "{{ pair[0] }}"
      ]{% if not loop.last %},{% endif %}

{% endfor %}
    ]
  }
{% endif %}
}